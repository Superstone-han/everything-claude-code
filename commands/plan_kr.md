---
description: 요구사항을 재진술하고, 위험을 평가하며, 단계별 구현 계획을 만듭니다. 코드를 건드리기 전에 사용자 확인을 기다리세요.
---

# Plan 명령어

이 명령어는 코드를 작성하기 전에 포괄적인 구현 계획을 만들기 위해 **planner** 에이전트를 호출합니다.

## 이 명령어가 하는 일

1. **요구사항 재진술** - 무엇을 만들어야 하는지 명확히 하기
2. **위험 식별** - 잠재적인 문제와 막힘 지점 표면화
3. **단계 계획 작성** - 구현을 단계로 분해
4. **확인 대기** - 진행 전에 사용자 승인 필수

## 사용 시점

다음과 같은 경우 `/plan`을 사용하세요:
- 새로운 기능 시작
- 중요한 아키텍처 변경
- 복잡한 리팩토링 작업
- 여러 파일/구성요소가 영향 받는 경우
- 요구사항이 불명확하거나 모호할 때

## 작동 방식

planner 에이전트는 다음을 수행합니다:

1. **요청 분석** 후 요구사항을 명확한 용어로 재진술
2. **단계로 분해** - 구체적이고 실행 가능한 단계
3. **종속성 식별** - 구성요소 간 의존성
4. **위험 평가** 및 잠재적 블로커
5. **복잡도 추정** (높음/중간/낮음)
6. **계획 제시** 후 명시적 확인을 기다림

## 사용 예시

```
User: /plan 마켓이 해결될 때 실시간 알림을 추가하고 싶어요

Agent (planner):
# 구현 계획: 실시간 마켓 해결 알림

## 요구사항 재진술
- 사용자가 보고 있는 마켓이 해결되면 알림 전송
- 여러 알림 채널 지원 (인앱, 이메일, 웹훅)
- 알림이 안정적으로 전달되도록 보장
- 마켓 결과와 사용자 포지션 결과 포함

## 구현 단계

### 1단계: 데이터베이스 스키마
- notifications 테이블 추가: id, user_id, market_id, type, status, created_at
- user_notification_preferences 테이블 추가: 채널 기본 설정
- 성능을 위해 user_id 및 market_id 인덱스 생성

### 2단계: 알림 서비스
- lib/notifications.ts에 알림 서비스 생성
- BullMQ/Redis로 알림 큐 구현
- 실패한 전달에 대한 재시도 로직 추가
- 알림 템플릿 생성

### 3단계: 통합 지점
- 마켓 해결 로직에 연결 (상태가 "resolved"로 변경될 때)
- 마켓에 포지션이 있는 모든 사용자 쿼리
- 각 사용자에 대해 알림 큐에 추가

### 4단계: 프론트엔드 구성요소
- 헤더에 NotificationBell 구성요소 생성
- NotificationList 모달 추가
- Supabase 구독으로 실시간 업데이트 구현
- 알림 기본 설정 페이지 추가

## 종속성
- Redis (큐용)
- 이메일 서비스 (SendGrid/Resend)
- Supabase 실시간 구독

## 위험
- 높음: 이메일 전달성 (SPF/DKIM 필요)
- 중간: 1000명 이상 사용자 있는 마켓의 성능
- 중간: 마켓이 자주 해결될 때 알림 스팸
- 낮음: 실시간 구독 오버헤드

## 예상 복잡도: 중간
- 백엔드: 4-6시간
- 프론트엔드: 3-4시간
- 테스트: 2-3시간
- 총계: 9-13시간

**승인 대기 중**: 이 계획으로 진행하시겠습니까? (yes/no/modify)
```

## 중요 참고사항

**CRITICAL**: planner 에이전트는 "yes" 또는 "proceed" 같은 명시적인 확인을 받기 전까지 **코드를 작성하지 않습니다**.

변경을 원하면 다음처럼 답하세요:
- "modify: [변경사항]"
- "different approach: [대안]"
- "skip phase 2 and do phase 3 first"

## 다른 명령어와의 연계

계획 후에는:
- `/tdd`로 테스트 주도 개발 구현
- 빌드 오류가 있으면 `/build-and-fix` 사용
- `/code-review`로 구현 검토

## 관련 에이전트

이 명령어는 다음 위치의 `planner` 에이전트를 호출합니다:
`~/.claude/agents/planner.md`
